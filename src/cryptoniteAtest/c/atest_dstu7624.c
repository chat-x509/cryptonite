/*
 * Copyright (c) 2016 PrivatBank IT <acsk@privatbank.ua>. All rights reserved.
 * Redistribution and modifications are permitted subject to BSD license.
 */

#include "atest.h"
#include "dstu7624.h"
#include "paddings.h"


typedef struct {
    char *key;
    char *iv;
    char *auth_data;
    char *plain_data;
    char *exp_h;
    char *exp_cip;
    size_t q;
    size_t Nb;
} Dstu7624CcmHelper;

typedef struct {
    char *key;
    char *data;
    char *exp;
} Dstu7624EcbHelper;

typedef struct {
    char *key;
    char *data;
    char *exp;
    size_t block_size;
} Dstu7624KwHelper;

typedef struct {
    char *key;
    char *iv;
    char *data;
    char *exp;
    size_t q;
} Dstu7624CfbHelper;

typedef struct {
    char *key;
    char *iv;
    char *data;
    char *exp;
} Dstu7624CbcHelper; //Так же для ofb, xts, ctr

typedef struct {
    char *key;
    char *data;
    char *exp;
    size_t q;
    size_t block_size;
} Dstu7624CmacHelper; //Так же для gmac

static void print_error_ccm(Dstu7624CcmHelper *data, char *file, int line)
{
    PR("%s Line %i: failed\n", file, line);
    PR("KEY:        %s\n", data->key);
    PR("IV:         %s\n", data->iv);
    PR("AUTH DATA:  %s\n", data->auth_data);
    PR("PLAIN DATA: %s\n", data->plain_data);
}

static Dstu7624EcbHelper enc_ecb_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "81BF1C7D779BAC20E1C9EA39B4D2AD06"
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F",
        "58EC3E091000158A1148F7166F334F14"
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "F66E3D570EC92135AEDAE323DCBD2A8CA03963EC206A0D5A88385C24617FD92C"
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606990E9E6B7B67A4BD6D893D72268B78E02C83C3CD7E102FD2E74A8FDFE5DD9"
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F",
        "4A26E31B811C356AA61DD6CA0596231A67BA8354AA47F3A13E1DEEC320EB56B895D0F417175BAB662FD6F134BB15C86CCB906A26856EFEB7C5BC6472940DD9D9"
    },
    {
        "0F0E0D0C0B0A09080706050403020100",
        "7291EF2B470CC7846F09C2303973DAD7",
        "1F1E1D1C1B1A19181716151413121110"
    },
    {
        "1F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "F36DB456CEFDDFE1B45B5F7030CAD996",
        "2F2E2D2C2B2A29282726252423222120",
    },
    {
        "1F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "7FC5237896674E8603C1E9B03F8B4BA3AB5B7C592C3FC3D361EDD12586B20FE3",
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A29282726252423222120"
    },
    {
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "18317A2767DAD482BCCD07B9A1788D075E7098189E5F84972D0B916D79BA6AE0",
        "5F5E5D5C5B5A595857565554535251504F4E4D4C4B4A49484746454443424140"
    },
    {
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "CE80843325A052521BEAD714E6A9D829FD381E0EE9A845BD92044554D9FA46A3757FEFDB853BB1F297FF9D833B75E66AAF4157ABB5291BDCF094BB13AA5AFF22",
        "7F7E7D7C7B7A797877767574737271706F6E6D6C6B6A696867666564636261605F5E5D5C5B5A595857565554535251504F4E4D4C4B4A49484746454443424140",
    }
};

static void test_encrypt_ecb_block(Dstu7624EcbHelper *data)
{
    ByteArray *data_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *expected_ba = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *actual_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_ecb(ctx, key_ba, ba_get_len(data_ba)));
    ASSERT_RET_OK(dstu7624_encrypt(ctx, data_ba, &actual_ba));
    CHECK_EQUALS_BA(expected_ba, actual_ba);

    dstu7624_free(ctx);
    ba_free(actual_ba);

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_ecb(ctx, key_ba, ba_get_len(data_ba)));
    ASSERT_RET_OK(dstu7624_decrypt(ctx, expected_ba, &actual_ba));

    CHECK_EQUALS_BA(data_ba, actual_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 ECB", key_ba, NULL, data_ba), count);

    dstu7624_free(ctx);
    BA_FREE(data_ba, key_ba, expected_ba, actual_ba);
}

static Dstu7624CbcHelper ctr_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748",
        "A90A6B9780ABDFDFF64D14F5439E88F266DC50EDD341528DD5E698E2F000CE21F872DAF9FE1811844A",
    }
};

static void test_ctr_loop(Dstu7624CbcHelper *data)
{
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *iv_ba = ba_alloc_from_le_hex_string(data->iv);
    ByteArray *data_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *exp_ba = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *act_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_ctr(ctx, key_ba, iv_ba));
    ASSERT_RET_OK(dstu7624_encrypt(ctx, data_ba, &act_ba));
    CHECK_EQUALS_BA(exp_ba, act_ba);

    dstu7624_free(ctx);
    ba_free(act_ba);

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_ctr(ctx, key_ba, iv_ba));
    ASSERT_RET_OK(dstu7624_decrypt(ctx, exp_ba, &act_ba));

    CHECK_EQUALS_BA(data_ba, act_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 CTR", key_ba, iv_ba, data_ba), count);

    BA_FREE(key_ba, iv_ba, data_ba, exp_ba, act_ba);
    dstu7624_free(ctx);

}

static Dstu7624CmacHelper cmac_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F",
        "123B4EAB8E63ECF3E645A99C1115E241",
        16,
        16
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D",
        "4CF52D7D5B0C47F05F6F5F5E73C3B508",
        16,
        16
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F"\
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "7279FA6BC8EF7525B2B35260D00A1743",
        16,
        64
    }
};

static void test_cmac_loop(Dstu7624CmacHelper *data)
{
    ByteArray *data_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *expected_ba = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *actual_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    //Так как данные для атестов есть только == размеру ключа, то...
    size_t block_size = data->block_size;
    size_t q = data->q;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_cmac(ctx, key_ba, block_size, q));
    ASSERT_RET_OK(dstu7624_update_mac(ctx, data_ba));
    ASSERT_RET_OK(dstu7624_final_mac(ctx, &actual_ba));

    CHECK_EQUALS_BA(expected_ba, actual_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 CMAC", key_ba, NULL, data_ba), count);

    ba_free(data_ba);
    ba_free(key_ba);
    ba_free(expected_ba);
    ba_free(actual_ba);
    dstu7624_free(ctx);
}

static Dstu7624CbcHelper xts_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "B3E431B3FBAF31108C302669EE7116D1CF518B6D329D30618DF5628E426BDEF1",
    },
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D",
        "48F3055ED2832222085005209C9D4D41B3E431B3FBAF31108C302669EE71",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F",
        "303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F",
        "830AC78A6F629CB4C7D5D156FD84955BD0998CA1E0BC1FF135676BF2A2598FA1",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F",
        "303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758",
        "830AC78A6F629CB4C7D5D156FD84955B470EEFDDEE38B59F0D836B65635B0A63D0998CA1E0BC1FF135",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F",
        "E0E51EAEA6A3134600758EA7F87E88025D8B82897C8DB099B843054C3A51883756913571530BA8FA23003E337627E698"\
        "674B807E847EC6B2292627736562F9F62B2DE9E6AAC5DF74C09A0C5CF80280174AEC9BDD4E73F7D63EDBC29A6922637A",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F80",
        "E0E51EAEA6A3134600758EA7F87E88025D8B82897C8DB099B843054C3A5188374F5254E38066B77FA14FEE3292464B60"\
        "7E8AF1398B2A91C4480B698D64D13AE856",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F"\
        "909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "30663E4686574B343A1898E46973CD37DB9D775D356512EB59E723397F2A333CE2C0E96538781FF48EA1D93BDF88FFF8"\
        "BB7BC4FB80A609881220C7FE21881C7374F65B232A8F94CD0E3DDC7614830C23CFCE98ADC5113496F9E106E8C8BFF3AB",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F"\
        "909192939495969798999A9B9C9D9E9FA0",
        "30663E4686574B343A1898E46973CD37DB9D775D356512EB59E723397F2A333C6DE04CB3235A2DA92493537248DE4368"\
        "879A7CC4166B25C9BFD1AD8EAEA3484BE2",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAF"\
        "B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF"\
        "E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF",
        "5C6250BD2E40AAE27E1E57512CD38E6A51D0C2B04F0D6A50E0CB43358B8C4E8BA361331436C6FFD38D77BBBBF5FEC56A"\
        "234108A6CC8CB298360943E849E5BD64D26ECA2FA8AEAD070656C3777BA412BCAF3D2F08C26CF86CA8F0921043A15D70"\
        "9AE1112611E22D4396E582CCB661E0F778B6F38561BC338AFD5D1036ED8B322D",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAF"\
        "B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF"\
        "E0",
        "C2822787D3CB2D13168B126583CF28E3B194F153088CF46BD745B22D1776BCB035C6CB17D8C1FBD127954C2A5D5F5AFB"\
        "ECF976E34966AB85142192A2463A541F5C6250BD2E40AAE27E1E57512CD38E6A51D0C2B04F0D6A50E0CB43358B8C4E8B"\
        "A3",
    }
};

static void test_xts_loop(Dstu7624CbcHelper *data)
{
    ByteArray *data_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *iv_ba = ba_alloc_from_le_hex_string(data->iv);
    ByteArray *expected_ba = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *actual_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_xts(ctx, key_ba, iv_ba));
    ASSERT_RET_OK(dstu7624_encrypt(ctx, data_ba, &actual_ba));

    CHECK_EQUALS_BA(expected_ba, actual_ba);

    ba_free(actual_ba);
    dstu7624_free(ctx);

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_xts(ctx, key_ba, iv_ba));
    ASSERT_RET_OK(dstu7624_decrypt(ctx, expected_ba, &actual_ba));

    CHECK_EQUALS_BA(data_ba, actual_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 XTS", key_ba, iv_ba, data_ba), count);

    dstu7624_free(ctx);
    BA_FREE(data_ba, key_ba, actual_ba, iv_ba, expected_ba);
}

static Dstu7624CbcHelper ofb_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F",
        "A19E3E5E53BE8A07C9E0C01298FF832953205C661BD85A51F3A94113BC785CAB634B36E89A8FDD16A12E4467F5CC5A26",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F90",
        "B62F7F144A8C6772E693A96890F064C3F06831BF743F5B0DD061067F3D22877331AA6A99D939F05B7550E9402BD1615C"\
        "C7B2D4A167E83EC0D8A894F92C72E176F3880B61C311D69CE1210C59184E818E19",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F"\
        "909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0",
        "0008F28A82D2D01D23BFB2F8BB4F06D8FE73BA4F48A2977585570ED3818323A668883C9DCFF610CC7E3EA5C025FBBC5C"\
        "A6520F8F11CA35CEB9B07031E6DBFABE39001E9A3CC0A24BBC565939592B4DEDBD",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAF"\
        "B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF"\
        "E0",
        "CAA761980599B3ED2E945C41891BAD95F72B11C73ED26536A6847458BC76C827357156B4B3FE0DC1877F5B9F17B866C3"\
        "7B21D89531DB48007D05DEC928B06766C014BB9080385EDF0677E48A0A39B5E7489E28E82FFFD1F84694F17296CB7016"\
        "56",
    },
    {
        "0F0E0D0C0B0A09080706050403020100",
        "1F1E1D1C1B1A19181716151413121110",
        "649A1EAAE160AF20F5B3EF2F58D66C1178B82E00D26F30689C8EC22E8E86E9CBB0BD4FFEE39EB13C2311276A906DD636",
        "4F4E4D4C4B4A494847464544434241403F3E3D3C3B3A393837363534333231302F2E2D2C2B2A29282726252423222120",
    },
    {
        "1F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "2F2E2D2C2B2A29282726252423222120",
        "1A66CFBFEC00C6D52E39923E858DD64B214AB787798D3D5059A6B498AD66B34EAC48C4074BEC0D98C6",
        "5F5E5D5C5B5A595857565554535251504F4E4D4C4B4A494847464544434241403F3E3D3C3B3A393837",
    },
    {
        "1F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A29282726252423222120",
        "7758A939DD6BD00CAF9153E5A5D5A66129105CA1EA54A97C06FA4A40960A068F55E34F9339A14436216948F92FA2FB52"\
        "86D3AB1E81543FC0018A0C4E8C493475F4D35DCFB0A7A5377F6669B857CDC978E4",
        "9F9E9D9C9B9A999897969594939291908F8E8D8C8B8A898887868584838281807F7E7D7C7B7A79787776757473727170"\
        "6F6E6D6C6B6A696867666564636261605F5E5D5C5B5A595857565554535251504F",
    },
    {
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A19181716151413121110"\
        "0F0E0D0C0B0A09080706050403020100",
        "5F5E5D5C5B5A595857565554535251504F4E4D4C4B4A49484746454443424140",
        "98E122708FDABB1B1A5765C396DC79D7573221EC486ADDABD1770B147A6DD00B5FBC4F1EC68C59775B7AAA4D43C4CCE4"\
        "F396D982DF64D30B03EF6C3B997BA0ED940BBC590BD30D64B5AE207147D71086B5",
        "BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0AFAEADACABAAA9A8A7A6A5A4A3A2A1A09F9E9D9C9B9A99989796959493929190"\
        "8F8E8D8C8B8A898887868584838281807F7E7D7C7B7A797877767574737271706F",
    },
    {
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A19181716151413121110"\
        "0F0E0D0C0B0A09080706050403020100",
        "7F7E7D7C7B7A797877767574737271706F6E6D6C6B6A696867666564636261605F5E5D5C5B5A59585756555453525150"\
        "4F4E4D4C4B4A49484746454443424140",
        "06C061A4A66DFC0910034B3CFBDC4206D8908241C56BF41C4103CFD6DF322210B87F57EAE9F9AD815E606A7D1E8E6BD7"\
        "CB1EBFBDBCB085C2D06BF3CC1586CB2EE1D81D38437F425131321647E42F5DE309D33F25B89DE37124683E4B44824FC5"\
        "6D",
        "EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0"\
        "BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0AFAEADACABAAA9A8A7A6A5A4A3A2A1A09F9E9D9C9B9A99989796959493929190"\
        "8F",
    }
};

static void test_ofb_loop(Dstu7624CbcHelper *data)
{
    ByteArray *data_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *iv_ba = ba_alloc_from_le_hex_string(data->iv);
    ByteArray *expected_ba = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *actual_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_ofb(ctx, key_ba, iv_ba));
    ASSERT_RET_OK(dstu7624_encrypt(ctx, data_ba, &actual_ba));

    CHECK_EQUALS_BA(expected_ba, actual_ba);

    ba_free(actual_ba);
    dstu7624_free(ctx);

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_ofb(ctx, key_ba, iv_ba));
    ASSERT_RET_OK(dstu7624_decrypt(ctx, expected_ba, &actual_ba));

    CHECK_EQUALS_BA(data_ba, actual_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 OFB", key_ba, iv_ba, data_ba), count);

    dstu7624_free(ctx);
    BA_FREE(data_ba, key_ba, iv_ba, expected_ba, actual_ba);
}

static Dstu7624CbcHelper cbc_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F",
        "A73625D7BE994E85469A9FAABCEDAAB6DBC5F65DD77BB35E06BD7D1D8EAFC8624D6CB31CE189C82B8979F2936DE9BF14",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F",
        "303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D",
        "13EA15843AD14C50BC03ECEF1F43E398E4217752D3EB046AC393DACC5CA1D6FA0EB9FCEB229362B4F1565527EE3D8433",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F",
        "9CDFDAA75929E7C2A5CFC1BF16B42C5AE3886D0258E8C577DC01DAF62D185FB999B9867736B87110F5F1BC7481912C59"\
        "3F48FF79E2AFDFAB9F704A277EC3E557B1B0A9F223DAE6ED5AF591C4F2D6FB22E48334F5E9B96B1A2EA5200F30A406CE",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F"\
        "909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "B8A2474578C2FEBF3F94703587BD5FDC3F4A4D2F43575B6144A1E1031FB3D1452B7FD52F5E3411461DAC506869FF8D2F"\
        "AEF4FEE60379AE00B33AA3EAF911645AF8091CD8A45D141D1FB150E5A01C1F26FF3DBD26AC4225EC7577B2CE57A5B0FF",
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAF"\
        "B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF"\
        "E0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF",
        "D4739B829EF901B24C1162AE4FDEF897EDA41FAC7F5770CDC90E1D1CDF124E8D7831E06B4498A4B6F6EC815DF2461DC9"\
        "9BB0449B0F09FCAA2C84090534BCC9329626FD74EF8F0A0BCB5765184629C3CBF53B0FB134F6D0421174B1C4E884D1CD"\
        "1069A7AD19752DCEBF655842E79B7858BDE01390A760D85E88925BFE38B0FA57",
    },
    {
        "0F0E0D0C0B0A09080706050403020100",
        "1F1E1D1C1B1A19181716151413121110",
        "88F2F048BA696170E3818915E0DBC0AFA6F141FEBC2F817138DA4AAB2DBF9CE490A488C9C82AC83FB0A6C0EEB64CFD22",
        "4F4E4D4C4B4A494847464544434241403F3E3D3C3B3A393837363534333231302F2E2D2C2B2A29282726252423222120",
    },
    {
        "1F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "2F2E2D2C2B2A29282726252423222120",
        "BC8F026FC603ECE05C24FDE87542730999B381870882AC0535D4368C4BABD81B884E96E853EE7E055262D9D204FBE212",
        "5F5E5D5C5B5A595857565554535251504F4E4D4C4B4A494847464544434241403F3E3D3C3B3A39383736353433323130"
    },
    {
        "1F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A29282726252423222120",
        "AD1C64FFA7EC7C733B1857C08BC76E3FCFA60629913AFDDC6DF5F06498D0664E68B0C2DAD5986FDBF0C8204BD7FECC39"\
        "3AE5FE473ED5EA4D8D08FC414634A2B688954443C979ABF9224D09DD2F6CD436CBB2857DF85A12AD8DCA0AEEE997C18B",
        "9F9E9D9C9B9A999897969594939291908F8E8D8C8B8A898887868584838281807F7E7D7C7B7A79787776757473727170"\
        "6F6E6D6C6B6A696867666564636261605F5E5D5C5B5A595857565554535251504F4E4D4C4B4A49484746454443424140"
    },
    {
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A19181716151413121110"\
        "0F0E0D0C0B0A09080706050403020100",
        "5F5E5D5C5B5A595857565554535251504F4E4D4C4B4A49484746454443424140",
        "C69A59E10D00F087319B62288A57417C074EAD07C732A87055F0A5AD2BB288105705C45E091A9A6726E9672DC7D8C76F"\
        "C45C782BCFEF7C39D94DEB84B17035BC8651255A0D34373451B6E1A2C827DB97566C9FF5506C5579F982A0EFC5BA7C28",
        "BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0AFAEADACABAAA9A8A7A6A5A4A3A2A1A09F9E9D9C9B9A99989796959493929190"\
        "8F8E8D8C8B8A898887868584838281807F7E7D7C7B7A797877767574737271706F6E6D6C6B6A69686766656463626160"
    },
    {
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "7F7E7D7C7B7A797877767574737271706F6E6D6C6B6A696867666564636261605F5E5D5C5B5A595857565554535251504F4E4D4C4B4A49484746454443424140",
        "5D5B3E3DE5BAA70E0A0684D458856CE759C6018D0B3F087FC1DAC101D380236DD934F2880B02D56A575BCA35A0CE4B0D"\
        "9BA1F4A39C16CA7D80D59956630F09E54EC91E32B6830FE08323ED393F8028D150BF03CAD0629A5AFEEFF6E442579806"\
        "18DB2F32B7B2B65B96E8451F1090829D2FFFC615CC1581E9221438DCEAD1FD12",
        "FFFEFDFCFBFAF9F8F7F6F5F4F3F2F1F0EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0"\
        "CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0AFAEADACABAAA9A8A7A6A5A4A3A2A1A0"\
        "9F9E9D9C9B9A999897969594939291908F8E8D8C8B8A89888786858483828180"
    }
};

static void test_cbc_loop(Dstu7624CbcHelper *data)
{
    ByteArray *data_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *iv_ba = ba_alloc_from_le_hex_string(data->iv);
    ByteArray *expected_ba = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *actual_ba = NULL;
    ByteArray *padded_ba = NULL;
    ByteArray *unpadded_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_cbc(ctx, key_ba, iv_ba));
    if (ba_get_len(data_ba) % ba_get_len(iv_ba) != 0) {
        ASSERT_RET_OK(make_iso_7816_4_padding(data_ba, (uint8_t) ba_get_len(iv_ba), &padded_ba));
        ba_free(data_ba);
        data_ba = padded_ba;
        padded_ba = NULL;
    }
    ASSERT_RET_OK(dstu7624_encrypt(ctx, data_ba, &actual_ba));

    CHECK_EQUALS_BA(expected_ba, actual_ba);

    ba_free(actual_ba);
    dstu7624_free(ctx);

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_cbc(ctx, key_ba, iv_ba));
    ASSERT_RET_OK(dstu7624_decrypt(ctx, expected_ba, &actual_ba));
    ASSERT_RET_OK(make_iso_7816_4_unpadding(actual_ba, &unpadded_ba));

    CHECK_EQUALS_BA(data_ba, actual_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 CBC", key_ba, iv_ba, data_ba), count);

    dstu7624_free(ctx);
    BA_FREE(data_ba, key_ba, iv_ba, expected_ba, actual_ba, padded_ba, unpadded_ba);
}

static Dstu7624KwHelper kw_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "1DC91DC6E52575F6DBED25ADDA95A1B6AD3E15056E489738972C199FB9EE2913",
        16
    },
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F2021",
        "0EA983D6CE48484D51462C32CC61672210FCC44196ABE635BAF878FDB83E1A63114128585D49DB355C5819FD38039169",
        16
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F",
        "2D09A7C18E6A5A0816331EC27CEA596903F77EC8D63F3BDB73299DE7FD9F4558E05992B0B24B39E02EA496368E0841CC"\
        "1E3FA44556A3048C5A6E9E335717D17D",
        16
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F"\
        "505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F",
        "BE59D3C3C31B2685A8FA57CD000727F16AF303F0D87BC2D7ABD80DC2796BBC4CDBC4E0408943AF4DAF7DE9084DC81BFE"\
        "F15FDCDD0DF399983DF69BF730D7AE2A199CA4F878E4723B7171DD4D1E8DF59C0F25FA0C20946BA64F9037D724BB1D50"\
        "B6C2BD9788B2AF83EF6163087CD2D4488BC19F3A858D813E3A8947A529B6D65D",
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F"\
        "505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F70",
        "CC41D643B08592F509432E3C6F4B73156907A53B9FFB99B157DEC708F917AEA1E41D76475EDFB138A8B0220A152B673E"\
        "9713DE7A2791E3573FE257C3FF3C0DAA9AD13477E52770F54CBF94D1603AED7CA876FB7913BC359D2B89562299FA92D3"\
        "2A9C17DBE4CC21CCE097089B9FBC245580D6DB59F8731D864B604E654397E5F5E7A79A6A777C75856039C8C86140D0CB"\
        "359CA3923D902D08269F8D48E7F0F085",
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F",
        "599217EB2B5270ECEF0BB716D70E251234A2451CE04FCFBAEEA92022C581F19B7C9386BB7476B4AD721D40778F49062C"\
        "3605F1E8FAC9F3F3AC04E46E89E1844DBF4F18FA9303B288741ABD71013CF208F31B4C76FBE342F89B1ABFD97E830457"\
        "555651B74D3CCDBF94CC5E5EEC22821536A96F44C8BC4346B0271303E67FD313",
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F90",
        "B92E58F53C38F7D23F1068FA98B921AC800AD0D1947BD620700D0B6088F87D03D6A516F54198154D0C71169C2BCF520F"\
        "3DF3DF527FC23E800E9A65158D45BB253A3BD0493E4822DF0DB5A366BC2F47551C5D477DDDE724A0B869F562223CEDB9"\
        "D4AA36C750FA864ADF938273FBC859F7D4930F6B70C6474304AB670BA32CB0C41023769338A29EA1555F526CDFEB75C7"\
        "2212CD2D29F4BA49C2A62ACBE4F3272B",
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F"\
        "A0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "9618AE6065069D5054464040F17337D58BEB51AE92391D740BDF7ABB239709C46270832039FF045BCF7878E7DA9C3B4C"\
        "F89326CA8B4D29DB8680EEAE1B5A18463284713A323A69AEBF33CFC4B11283C7C8041FFC97668EDF727823411C955981"\
        "6C108C11EC401643765527860D8DA0ED7254792C21DB775DEB1D6971C924CC83EB626173D894694943B1828ABDE8F949"\
        "5BCEBA9AC3A4A03592C085AA29CC9A0C65786E631A702D589B819C89E79EEFF29C4EC312C8860BB68F02272EA770FB8D",
        64
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F"\
        "A0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECF"\
        "D0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0",
        "3A05BB41513555F171E9234D4834EDAD16C0BAA6136197650138219C5DA406A703C39259E9DCCF6F2691EC691CE7414B"\
        "5D3CDA006DE6D6C62142FAAA742C5F8AF64FCE95BE7ABA7FE5E06C3C33EE67BAEAB196E3A71132CAE78CD605A22E34D5"\
        "3CD159217E7B692CC79FAC66BF5E08DBC4FE274299474E176DDDF9F462AC63F4872E9B7F16B98AA56707EE5F2F94616C"\
        "FC6A9548ADBD7DCB73664C331213964593F712ECCDFA7A94E3ABA7995176EA4B7E77096A3A3FF4E4087F430B62D5DEE6"\
        "4999F235FA9EAC79896A1C2258BF1DFC8A6AD0E5E7E06EAEEA0CCC2DEF62F67ECE8D12EFF432277C40A7BF1A23440B35"\
        "33AF1E2F7AE1BBC076D12628BB4BC7B2E4D4B4353BCEAF9A67276B3FA23CADCA80062B95EBB2D51510AFA16F97249DF9"\
        "8E7B845C9A410F24B3C8B3E838E58D22BC2D14F46190FC1BFDB60C9691404F99",
        64
    }
};

static void test_kw_loop(Dstu7624KwHelper *data)
{
    ByteArray *data_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *expected_ba = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *actual_ba = NULL;
    size_t block_size = data->block_size;
    Dstu7624Ctx *ctx = NULL;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_kw(ctx, key_ba, block_size));
    ASSERT_RET_OK(dstu7624_encrypt(ctx, data_ba, &actual_ba));

    CHECK_EQUALS_BA(expected_ba, actual_ba);

    dstu7624_free(ctx);
    ba_free(actual_ba);
    actual_ba = NULL;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_kw(ctx, key_ba, block_size));
    ASSERT_RET_OK(dstu7624_decrypt(ctx, expected_ba, &actual_ba));

    CHECK_EQUALS_BA(data_ba, actual_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 KW", key_ba, NULL, data_ba), count);

    dstu7624_free(ctx);
    BA_FREE(data_ba, key_ba, expected_ba, actual_ba);
}

static Dstu7624CfbHelper cfb_data[] = {
//        {
//                "000102030405060708090A0B0C0D0E0F",
//                "101112131415161718191A1B1C1D1E1F",
//                "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F",
//                "A19E3E5E53BE8A07C9E0C01298FF83291F8EE6212110BE3FA5C72C88A082520B265570FE28680719D9B4465E169BC37A",
//                16,
//        },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F90",
        "E07821AF642F4B1DC071166F2D329763C2CF3B9E39CD0B52BDD33A0DC7B6B6BB201C4A1CD0F5DCB693ABEEA120DACA3A"\
        "29C73D1D6E87FD75B7DE9E3BE4D256791C2E44583DE8E061E45834A24262BDEBBE",
        16
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F"\
        "909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0",
        "0008F28A82D2D01D23BFB2F8BB4F06D8FE73BA4F48A2977585570ED3818323A6DBAD3D9DD580D9D8F787CE55FAB90735"\
        "F6B2D6152D56C0C787E6F4B6A2F557DF707A671D06AED196DD7D7E2320D8E45C4C",
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F"\
        "303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F"\
        "707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAF"\
        "B0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDF"\
        "E0",
        "CAA761980599B3ED2E945C41891BAD95F72B11C73ED26536A6847458BC76C827357156B4B3FE0DC1877F5B9F17B866C3"\
        "7B21D89531DB48007D05DEC928B06766C67D6F3F4C2B82D7A836FAD160905C1C7576243877DC3ADE4AA057966E0023F0"\
        "69",
        64
    },
    {
        "1F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "2F2E2D2C2B2A29282726252423222120",
        "26319A368D85DE43DD5FDB928D91A441493D8CE07B64797C8F9676C5921CD1EA743F5E2777C327AC58",
        "5F5E5D5C5B5A595857565554535251504F4E4D4C4B4A494847464544434241403F3E3D3C3B3A393837",
        8
    },
    {
        "1F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100",
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A29282726252423222120",
        "7758A939DD6BD00CAF9153E5A5D5A66129105CA1EA54A97C06FA4A40960A068F61C3E424DE950151AC46879D84A3BCC2"\
        "4EC8FB69008DAF016EF9832FFD3DB39D02185FDB782DC28EAC27B35179FCA40640",
        "9F9E9D9C9B9A999897969594939291908F8E8D8C8B8A898887868584838281807F7E7D7C7B7A79787776757473727170"\
        "6F6E6D6C6B6A696867666564636261605F5E5D5C5B5A595857565554535251504F",
        32
    },
    {
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A19181716151413121110"\
        "0F0E0D0C0B0A09080706050403020100",
        "5F5E5D5C5B5A595857565554535251504F4E4D4C4B4A49484746454443424140",
        "98E122708FDABB1B1A5765C396DC79D7573221EC486ADDABD1770B147A6DD00BDD5E4F1496D4D573923F9809EEEEF46B"\
        "063C64A5E875E77E65EC6832ECE3C24A4B8FD40B04088CBEE2CDECE4DC3CC5573A",
        "BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0AFAEADACABAAA9A8A7A6A5A4A3A2A1A09F9E9D9C9B9A99989796959493929190"\
        "8F8E8D8C8B8A898887868584838281807F7E7D7C7B7A797877767574737271706F",
        32
    },
    {
        "3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A19181716151413121110"\
        "0F0E0D0C0B0A09080706050403020100",
        "7F7E7D7C7B7A797877767574737271706F6E6D6C6B6A696867666564636261605F5E5D5C5B5A59585756555453525150"\
        "4F4E4D4C4B4A49484746454443424140",
        "06C061A4A66DFC0910034B3CFBDC4206D8908241C56BF41C4103CFD6DF322210B87F57EAE9F9AD815E606A7D1E8E6BD7"\
        "CB1EBFBDBCB085C2D06BF3CC1586CB2E88C9155E95B4872D86B49D80F5745B605EAF488AA520A717A92F4D68838E42C995",
        "EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0"\
        "BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0AFAEADACABAAA9A8A7A6A5A4A3A2A1A09F9E9D9C9B9A999897969594939291908F",
        64
    }
};

static void test_cfb_loop(Dstu7624CfbHelper *data)
{
    ByteArray *data_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *iv_ba = ba_alloc_from_le_hex_string(data->iv);
    ByteArray *expected_ba = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *actual_ba = NULL;
    size_t q = data->q;
    Dstu7624Ctx *ctx = NULL;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_cfb(ctx, key_ba, iv_ba, q));
    ASSERT_RET_OK(dstu7624_encrypt(ctx, data_ba, &actual_ba));

    CHECK_EQUALS_BA(expected_ba, actual_ba);

    ba_free(actual_ba);
    dstu7624_free(ctx);

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_cfb(ctx, key_ba, iv_ba, q));
    ASSERT_RET_OK(dstu7624_decrypt(ctx, expected_ba, &actual_ba));

    CHECK_EQUALS_BA(data_ba, actual_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 CFB", key_ba, iv_ba, data_ba), count);

    dstu7624_free(ctx);
    BA_FREE(data_ba, key_ba, iv_ba, expected_ba, actual_ba);
}

Dstu7624CcmHelper ccm_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F",
        "303132333435363738393A3B3C3D3E3F",
        "26A936173A4DC9160D6E3FDA3A974060",
        "B91A7B8790BBCFCFE65D04E5538E98E2704454C9DD39ADACE0B19D03F6AAB07E",
        16,
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F",
        "303132333435363738393A3B",
        "404142434445464748494A4B4C4D4E",
        "6C47296FF6F64D3FB8351B8407E791D5",
        "EF93E26C7D5EB27111A188722593043585DF9998FE26308ACBA4FC0EB5F2C7",
        16,
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F",
        "9AB831B4B0BF0FDBC36E4B4FD58F0F00",
        "7EC15C54BB553CB1437BE0EFDD2E810F6058497EBCE4408A08A73FADF3F459D56B0103702D13AB73ACD2EB33A8B5E9CFFF5EB21865A6B499C10C810C4BAEBE80"\
        "9C48AD90A9E12A68380EF1C1B7C83EE1",
        16,
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "924FA0326824355595C98028E84D86279CEA9135FAB35F22054AE3203E68AE46",
        "3EBDB4584B5169A26FBEBA0295B4223F58D5D8A031F2950A1D7764FAB97BA058E9E2DAB90FF0C519AA88435155A71B7B"\
        "53BB100F5D20AFFAC0552F5F2813DEE8DD3653491737B9615A5CCD83DB32F1E479BF227C050325BBBFF60BCA9558D7FE",
        32,
        48
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "C0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF",
        "D4155EC3D888C8D32FE184AC260FD60F567705E1DF362A6F1F9C287156AA96D91BC4C56F9709E72F3D79CF0A9AC8BDC2BA836BE50E823AB50FB1B39080390923",
        "220642D7277D104788CF97B10210984F506435512F7BF153C5CDABFECC10AFB4A2E2FC51F616AF80FFDD0607FAD4F542B8EF0667717CE3EAAA8FBC303CE76C99"\
        "BD8F80CE149143C04FC2490272A31B029DDADA82F055FE4ABEF452A7D438B21E59C1D8B3DD4606BAD66A6F36300EF3CE0E5F3BB59F11416E80B7FC5A8E8B057A",
        64,
        64
    }
};

static void test_ccm_loop(Dstu7624CcmHelper *data)
{
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *iv_ba = ba_alloc_from_le_hex_string(data->iv);
    ByteArray *au_ba = ba_alloc_from_le_hex_string(data->auth_data);
    ByteArray *pl_ba = ba_alloc_from_le_hex_string(data->plain_data);
    ByteArray *exp_ba_h = ba_alloc_from_le_hex_string(data->exp_h);
    ByteArray *exp_ba_cip = ba_alloc_from_le_hex_string(data->exp_cip);
    ByteArray *h_ba = NULL;
    ByteArray *actual_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    size_t q = data->q;
    size_t Nb = data->Nb;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_ccm(ctx, key_ba, iv_ba, q, Nb));
    ASSERT_RET_OK(dstu7624_encrypt_mac(ctx, au_ba, pl_ba, &h_ba, &actual_ba));

    CHECK_EQUALS_BA(exp_ba_h, h_ba);

    ba_free(actual_ba);

    ASSERT_RET_OK(dstu7624_decrypt_mac(ctx, au_ba, exp_ba_cip, h_ba, &actual_ba));

    CHECK_EQUALS_BA(pl_ba, actual_ba);

cleanup:

    if (error_count != count) {
        print_error_ccm(data, __FILE__, __LINE__);
    }

    BA_FREE(key_ba, iv_ba, au_ba, pl_ba, exp_ba_h, h_ba, exp_ba_cip, actual_ba);
    dstu7624_free(ctx);
}

static Dstu7624CmacHelper gmac_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "303132333435363738393A3B3C3D3E3F",
        "5AE309EE80B583C6523397ADCB5704C4",
        16,
        16
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "FF48B56F2C26CC484B8F5952D7B3E1FE",
        16,
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "FF48B56F2C26CC484B8F5952D7B3E1FE69577701C50BE96517B33921E44634CD",
        32,
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F",
        "96F61FA0FDE92883C5041D748F9AE91F3A0A50415BFA1466855340A5714DC01F",
        32,
        32
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "897C32E05E776FD988C5171FE70BB72949172E514E3308A871BA5BD898FB6EBD6E3897D2D55697D90D6428216C08052E3A5E7D4626F4DBBF1546CE21637357A3",
        64,
        64
    },
};

static void test_gmac_loop(Dstu7624CmacHelper *data)
{
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *pl_ba = ba_alloc_from_le_hex_string(data->data);
    ByteArray *exp_ba_h = ba_alloc_from_le_hex_string(data->exp);
    ByteArray *actual_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    size_t block_size = data->block_size;
    size_t q = data->q;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_gmac(ctx, key_ba, block_size, q));
    ASSERT_RET_OK(dstu7624_update_mac(ctx, pl_ba));
    ASSERT_RET_OK(dstu7624_final_mac(ctx, &actual_ba));

    CHECK_EQUALS_BA(exp_ba_h, actual_ba);

cleanup:

    PRINT_ERROR(print_cipher_error("DSTU7624 GMAC", key_ba, NULL, pl_ba), count);

    BA_FREE(pl_ba, actual_ba, key_ba, exp_ba_h);
    dstu7624_free(ctx);
}

static Dstu7624CcmHelper gcm_data[] = {
    {
        "000102030405060708090A0B0C0D0E0F",
        "101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F",
        "303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F",
        "C8310571CD60F9584B45C1B4ECE179AF",
        "B91A7B8790BBCFCFE65D04E5538E98E216AC209DA33122FDA596E8928070BE51",
        16,
        0
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F",
        "303132333435363738393A3B3C3D3E3F",
        "505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F",
        "3C474281AFEAE4FD6D61E995258747AB",
        "FF83F27C6D4EA26101B1986235831406A297940D6C0E695596D612623E0E7CDC",
        16,
        0
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F",
        "1D61B0A3018F6B849CBA20AF1DDDA245",
        "7EC15C54BB553CB1437BE0EFDD2E810F6058497EBCE4408A08A73FADF3F459D56B0103702D13AB73ACD2EB33A8B5E9CFFF5EB21865A6B499C10C810C4BAEBE80",
        16,
        0
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F",
        "202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9F",
        "1D61B0A3018F6B849CBA20AF1DDDA245B1B296258AC0352A52D3F372E72224CE",
        "7EC15C54BB553CB1437BE0EFDD2E810F6058497EBCE4408A08A73FADF3F459D56B0103702D13AB73ACD2EB33A8B5E9CFFF5EB21865A6B499C10C810C4BAEBE80",
        32,
        0
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F",
        "606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "8555FD3D9B02C2325ACA3CC9309D6B4B9AFC697D13BBBFF067198D5D86CB9820",
        "3EBDB4584B5169A26FBEBA0295B4223F58D5D8A031F2950A1D7764FAB97BA058E9E2DAB90FF0C519AA88435155A71B7B53BB100F5D20AFFAC0552F5F2813DEE8",
        32,
        0
    },
    {
        "000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F",
        "404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F",
        "808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBF",
        "C0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF",
        "78A77E5948F5DC05F551486FDBB44898C9AB1BD439D7519841AE31007C09E1B312E5EA5929F952F6A3EEF5CBEAEF262B8EC1884DFCF4BAAF7B5C9291A22489E1",
        "220642D7277D104788CF97B10210984F506435512F7BF153C5CDABFECC10AFB4A2E2FC51F616AF80FFDD0607FAD4F542B8EF0667717CE3EAAA8FBC303CE76C99",
        64,
        0
    }
};

static void test_gcm_loop(Dstu7624CcmHelper *data)
{
    ByteArray *key_ba = ba_alloc_from_le_hex_string(data->key);
    ByteArray *pl_ba = ba_alloc_from_le_hex_string(data->plain_data);
    ByteArray *au_ba = ba_alloc_from_le_hex_string(data->auth_data);
    ByteArray *iv_ba = ba_alloc_from_le_hex_string(data->iv);
    ByteArray *exp_ba_h = ba_alloc_from_le_hex_string(data->exp_h);
    ByteArray *exp_cip_ba = ba_alloc_from_le_hex_string(data->exp_cip);
    ByteArray *act_h_ba = NULL;
    ByteArray *act_cip_ba = NULL;
    ByteArray *exp_dec_ba = NULL;
    Dstu7624Ctx *ctx = NULL;
    size_t q = data->q;
    size_t count = error_count;

    ASSERT_NOT_NULL(ctx = dstu7624_alloc(DSTU7624_SBOX_1));
    ASSERT_RET_OK(dstu7624_init_gcm(ctx, key_ba, iv_ba, q));
    ASSERT_RET_OK(dstu7624_encrypt_mac(ctx, au_ba, pl_ba, &act_h_ba, &act_cip_ba));

    CHECK_EQUALS_BA(exp_ba_h, act_h_ba);
    CHECK_EQUALS_BA(exp_cip_ba, act_cip_ba);

    ASSERT_RET_OK(dstu7624_decrypt_mac(ctx, au_ba, act_cip_ba, act_h_ba, &exp_dec_ba));

    CHECK_EQUALS_BA(pl_ba, exp_dec_ba);

cleanup:
    if (error_count != count) {
        print_error_ccm(data, __FILE__, __LINE__);
    }
    BA_FREE(pl_ba, act_h_ba, key_ba, iv_ba, exp_ba_h, au_ba, act_cip_ba, exp_cip_ba, exp_dec_ba);
    dstu7624_free(ctx);
}

void atest_dstu7624(void)
{
    size_t err_count = error_count;

    ATEST_CORE(enc_ecb_data, test_encrypt_ecb_block, sizeof(Dstu7624EcbHelper));
    ATEST_CORE(ctr_data, test_ctr_loop, sizeof(Dstu7624CbcHelper));
    ATEST_CORE(cmac_data, test_cmac_loop, sizeof(Dstu7624CmacHelper));
    ATEST_CORE(ofb_data, test_ofb_loop, sizeof(Dstu7624CbcHelper));
    ATEST_CORE(cbc_data, test_cbc_loop, sizeof(Dstu7624CbcHelper));
    ATEST_CORE(kw_data, test_kw_loop, sizeof(Dstu7624KwHelper));
    ATEST_CORE(cfb_data, test_cfb_loop, sizeof(Dstu7624CfbHelper));
    ATEST_CORE(ccm_data, test_ccm_loop, sizeof(Dstu7624CcmHelper));
    ATEST_CORE(gmac_data, test_gmac_loop, sizeof(Dstu7624CmacHelper));
    ATEST_CORE(gcm_data, test_gcm_loop, sizeof(Dstu7624CcmHelper));
    ATEST_CORE(xts_data, test_xts_loop, sizeof(Dstu7624CbcHelper));

    if (err_count == error_count) {
        msg_print_atest("DSTU7624", "[ecb,ctr,cfb,cbc,ofb,kw,cmac,ccm,gcm,gmac]", "OK");
    } else {
        msg_print_atest("DSTU7624", "", "FAILED");
    }

    return;
}
